<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆ - æ–°ã—ã„ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            line-height: 1.6;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: #34495e;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .menu-button {
            background: linear-gradient(135deg, #4169E1, #FFD700);
            border: none;
            border-radius: 25px;
            padding: 15px 30px;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            display: block;
            width: 200px;
        }
        
        .menu-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .console-output {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
            white-space: pre-wrap;
        }
        
        .test-button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .status.success { background: #27ae60; }
        .status.error { background: #e74c3c; }
        .status.warning { background: #f39c12; }
        .status.info { background: #3498db; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª æ–°ã—ã„ã‚²ãƒ¼ãƒ ãƒœã‚¿ãƒ³ ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="status info" id="status">
            ãƒ†ã‚¹ãƒˆæº–å‚™ä¸­...
        </div>
        
        <h2>ãƒ†ã‚¹ãƒˆå¯¾è±¡ãƒœã‚¿ãƒ³</h2>
        <button id="btn-new-game" class="menu-button" data-action="start_game">
            <span class="btn-icon">âœ¨</span>
            <span class="btn-text">æ–°ã—ã„ã‚²ãƒ¼ãƒ </span>
        </button>
        
        <h2>ãƒ†ã‚¹ãƒˆåˆ¶å¾¡</h2>
        <button class="test-button" onclick="testButtonSetup()">ãƒœã‚¿ãƒ³è©³ç´°åˆ†æ</button>
        <button class="test-button" onclick="debugClickButton()">æ‰‹å‹•ã‚¯ãƒªãƒƒã‚¯å®Ÿè¡Œ</button>
        <button class="test-button" onclick="setupMenuButtonHandlers()">ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å†è¨­å®š</button>
        <button class="test-button" onclick="addBackupButtonHandler()">ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¿½åŠ </button>
        <button class="test-button" onclick="clearConsole()">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¯ãƒªã‚¢</button>
        
        <h2>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›</h2>
        <div class="console-output" id="console-output">
            ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...
        </div>
        
        <h2>æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ</h2>
        <ol>
            <li>ã€Œæ–°ã—ã„ã‚²ãƒ¼ãƒ ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
            <li>ã‚¢ãƒ©ãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹: "startNewGame()ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã—ãŸï¼"</li>
            <li>ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è©³ç´°ãªãƒ‡ãƒãƒƒã‚°æƒ…å ±ãŒå‡ºåŠ›</li>
            <li>ãƒã‚ªãƒ³æ¼”å‡ºãŒé–‹å§‹ã•ã‚Œã‚‹ï¼ˆæœ¬æ¥ã®å‹•ä½œï¼‰</li>
        </ol>
        
        <h2>ãƒ†ã‚¹ãƒˆçµæœ</h2>
        <div id="test-results"></div>
    </div>

    <script>
        // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToOutput(message, type = 'log') {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            let color = '#00ff00';
            
            switch(type) {
                case 'error': color = '#ff4444'; break;
                case 'warn': color = '#ffaa00'; break;
                case 'info': color = '#44aaff'; break;
            }
            
            const logLine = `[${timestamp}] ${message}\n`;
            output.innerHTML += `<span style="color: ${color}">${logLine}</span>`;
            output.scrollTop = output.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToOutput(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToOutput('ERROR: ' + args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToOutput('WARN: ' + args.join(' '), 'warn');
        };
        
        // ã‚²ãƒ¼ãƒ é–¢æ•°ã®ãƒ¢ãƒƒã‚¯å®Ÿè£…
        let gameEngine = {
            resetGameState: function() {
                console.log('ğŸ”„ Mock: Game state reset');
            },
            transitionToScene: function(scene) {
                console.log('ğŸ¬ Mock: Transitioning to scene:', scene);
                return Promise.resolve();
            }
        };
        
        let gameInitialized = true;
        let gameInstance = { mock: true };
        
        window.neonTransition = {
            start: function() {
                console.log('ğŸ¬ Mock: Neon transition started');
                document.getElementById('status').innerHTML = 'âœ… ãƒã‚ªãƒ³æ¼”å‡ºãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸï¼ˆãƒ¢ãƒƒã‚¯ï¼‰';
                document.getElementById('status').className = 'status success';
            }
        };
        
        // ãƒ†ã‚¹ãƒˆç”¨ã®startNewGameé–¢æ•°
        function startNewGame() {
            console.log('ğŸ® ========== START NEW GAME CALLED ==========');
            console.log('ğŸ” Function startNewGame() has been executed!');
            
            // ãƒ‡ãƒãƒƒã‚°ç”¨ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºå®Ÿã«ä¼ãˆã‚‹ï¼‰
            alert('ğŸ® startNewGame()ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã—ãŸï¼\\nã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            
            console.log('ğŸ” Debug info:');
            console.log('  - gameEngine available:', !!gameEngine);
            console.log('  - gameEngine type:', typeof gameEngine);
            console.log('  - neonTransition available:', !!window.neonTransition);
            console.log('  - neonTransition type:', typeof window.neonTransition);
            console.log('  - gameInitialized flag:', gameInitialized);
            console.log('  - gameInstance:', gameInstance);
            console.log('  - Document ready state:', document.readyState);
            
            if (gameEngine) {
                // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
                gameEngine.resetGameState();
                
                // ãƒã‚ªãƒ³æ¼”å‡ºã‚’é–‹å§‹
                if (window.neonTransition) {
                    console.log('ğŸ¬ Starting neon transition...');
                    try {
                        window.neonTransition.start();
                        console.log('âœ… Neon transition started successfully');
                    } catch (error) {
                        console.error('âŒ Error starting neon transition:', error);
                        console.error('âŒ Error stack:', error.stack);
                        alert('âŒ ãƒã‚ªãƒ³æ¼”å‡ºã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
                    }
                } else {
                    console.warn('âš ï¸ Neon transition not available');
                    alert('âš ï¸ ãƒã‚ªãƒ³æ¼”å‡ºãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
            } else {
                console.error('âŒ Game engine not available!');
                alert('âŒ ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
            }
        }
        
        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¨­å®š
        function setupMenuButtonHandlers() {
            console.log('ğŸ”§ Setting up menu button handlers...');
            
            const newGameBtn = document.getElementById('btn-new-game');
            console.log('ğŸ” New game button element:', newGameBtn);
            
            if (newGameBtn) {
                console.log('âœ… New game button found, adding event listener');
                
                // æ—¢å­˜ã®ãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤
                const newBtn = newGameBtn.cloneNode(true);
                newGameBtn.parentNode.replaceChild(newBtn, newGameBtn);
                
                newBtn.addEventListener('click', (event) => {
                    console.log('ğŸ® New game button CLICKED!', event);
                    console.log('ğŸ® Event details:', {
                        target: event.target,
                        currentTarget: event.currentTarget,
                        type: event.type,
                        bubbles: event.bubbles
                    });
                    
                    event.preventDefault();
                    event.stopPropagation();
                    
                    console.log('ğŸ® Calling startNewGame()...');
                    startNewGame();
                });
                
                console.log('âœ… Event listener attached to new game button');
                document.getElementById('status').innerHTML = 'âœ… ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ãŒè¨­å®šã•ã‚Œã¾ã—ãŸ';
                document.getElementById('status').className = 'status success';
            } else {
                console.error('âŒ New game button not found!');
                document.getElementById('status').innerHTML = 'âŒ ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
                document.getElementById('status').className = 'status error';
            }
        }
        
        // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
        function addBackupButtonHandler() {
            console.log('ğŸ›¡ï¸ Adding backup button handlers as failsafe...');
            
            const newGameBtn = document.getElementById('btn-new-game');
            if (newGameBtn) {
                console.log('ğŸ›¡ï¸ New game button found for backup handlers');
                
                // onclick property backup
                newGameBtn.onclick = function(event) {
                    console.log('ğŸ›¡ï¸ Backup onclick handler triggered!');
                    event.preventDefault();
                    event.stopPropagation();
                    alert('ğŸ›¡ï¸ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒå‹•ä½œã—ã¾ã—ãŸï¼');
                    startNewGame();
                };
                
                console.log('âœ… Backup handler installed');
                document.getElementById('status').innerHTML = 'ğŸ›¡ï¸ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ';
                document.getElementById('status').className = 'status warning';
            }
        }
        
        // ãƒœã‚¿ãƒ³ãƒ†ã‚¹ãƒˆ
        function testButtonSetup() {
            console.log('ğŸ§ª ========== TESTING BUTTON SETUP ==========');
            
            const newGameBtn = document.getElementById('btn-new-game');
            console.log('ğŸ” Button element:', newGameBtn);
            
            if (newGameBtn) {
                console.log('ğŸ” Button details:');
                console.log('  - ID:', newGameBtn.id);
                console.log('  - Classes:', newGameBtn.classList.toString());
                console.log('  - Text content:', newGameBtn.textContent);
                console.log('  - onclick property:', typeof newGameBtn.onclick);
                console.log('  - Computed style display:', getComputedStyle(newGameBtn).display);
                console.log('  - offsetWidth/Height:', newGameBtn.offsetWidth, 'x', newGameBtn.offsetHeight);
                
                document.getElementById('status').innerHTML = 'ğŸ§ª ãƒœã‚¿ãƒ³ãƒ†ã‚¹ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸï¼ˆè©³ç´°ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªï¼‰';
                document.getElementById('status').className = 'status info';
            } else {
                console.error('âŒ Button element not found!');
                document.getElementById('status').innerHTML = 'âŒ ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
                document.getElementById('status').className = 'status error';
            }
        }
        
        // æ‰‹å‹•ã‚¯ãƒªãƒƒã‚¯
        function debugClickButton() {
            console.log('ğŸ§ª Manual button click test...');
            const btn = document.getElementById('btn-new-game');
            if (btn) {
                console.log('ğŸ§ª Triggering click on button...');
                btn.click();
            } else {
                console.error('âŒ Button not found for manual click');
            }
        }
        
        // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¯ãƒªã‚¢
        function clearConsole() {
            document.getElementById('console-output').innerHTML = 'ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ...\\n';
        }
        
        // è‡ªå‹•åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Debug test page loaded');
            
            setTimeout(() => {
                setupMenuButtonHandlers();
                testButtonSetup();
            }, 100);
        });
    </script>
</body>
</html>